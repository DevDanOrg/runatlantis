repos:
  - id: /.*/
    repo_config_file: "./atlantis.yaml"
    workflow: makeworkflow
    allowed_overrides: [apply_requirements, workflow]
    allow_custom_workflows: true
    pre_workflow_hooks:
      - run: "cat ~/workspace/git/runatlantis/atlantis.yaml > atlantis.yaml"

workflow:
  makeworkflow:
    plan:
      steps:
        - env:
            name: TF_WORKSPACE
            command: echo $WORKSPACE
        - run: make clean_state init plan
    apply:
      steps:
        - run: make init apply
    import:
      steps:
        - run: rm -rf .terraform terraform.tfstate*