version: 3
projects:
- name: runatlantis
  dir: .
  branch: /(main|master)/
  autoplan:
    enabled: true
    when_modified:
      - './modules/**/*.tf'
      - './modules/**/*.sh'
      - './modules/**/*.json'
      - '.terraform.lock.hcl'
      - '*.tfvars'
  apply_requirements: [approved, mergeable]
  workflow: makeworkflow
workflows:
  makeworkflow:
    plan:
      steps:
        - run: make clean-state atlantis-init atlantis-plan
    apply:
      steps:
        - run: make atlantis-init atlantis-apply
